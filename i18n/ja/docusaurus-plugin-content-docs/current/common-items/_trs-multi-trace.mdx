**マルチトランザクション**は、別のエージェントやプロジェクトに関連付けられたトランザクションを意味します。WhaTapプロジェクトに登録されたアプリケーションサービス間の呼び出しを追跡するのが、**マルチトランザクション追跡**です。 

<InDoc product="java">

:::info

Javaエージェントは、3つのHTTPヘッダーキー値(`x-wtap-po`、`x-wtap-mst`、`x-wtap-sp1`)でマルチトランザクションを追跡します。ゲートウェイを通過するHTTPトランザクションの連携追跡ができない場合は、HTTPヘッダー条件を確認してください。

:::

</InDoc>

:::note

**マルチトランザクションの活性化**

マルチトランザクションを追跡するには<Cmdname sid="side_management" className="uitext" /> &gt; <Cmdname sid="side_agentSetting" className="uitext" />メニューから`mtrace_enabled`オプションを`true`に設定してください。エージェント設定の詳細については[次の文書](set-agent#set-agent-service)を参照してください。

:::

## マルチTX追跡 {#trace-multi-tx}

ホーム画面 &gt; プロジェクト選択 &gt; <Cmdname sid="side_analysis" className="uitext" /> &gt; <Cmdname sid="side_hitmap" className="uitext" />メニューからチャート領域をドラッグします。ドラッグしたチャート領域のトランザクション情報は、次のように下部の<Cmdname sid="trace_list" className="uitext" />一覧に表示されます。一覧でマルチトランザクションを含むトランザクションは、![アイコン](/img/ic-s-mult-transation.svg)アイコンが表示されます。

<ImgLang img='tx-trace-table.png' desc='mtrace_M' />

該当するトレースを選択すると、<Cmdname sid="TTL06527" className="uitext" />画面が表示されます。マルチトランザクションが追跡される場合、<Cmdname sid="TTL06125" className="uitext" />タブで<Cmdname sid="TTL06107" className="uitext" />値を確認できます。トランザクションから外部呼び出しを行う場合も、同様の<Cmdname sid="TTL06107" className="uitext" />が生成されます。サービス別にプロジェクトが分離されていても、最初に発行した<Cmdname sid="TTL06107" className="uitext" />を通じて、アプリケーション間のすべてのトランザクションを確認できます。<Cmdname sid="TTL06527" className="uitext" />画面でのトランザクショントレースの詳細ば分析の詳細については、[次の文書](trs-profile#details)を参照してください。

<ImgLang img='tx-trace-dt-up.png' desc='レコード概要' />

<Cmdname sid="TTL06107" className="uitext" />を選択すると、<Cmdname sid="TTL06377" className="uitext" />タブが表示されます。システム内またはシステム間で発生するさまざまな呼び出し関係を一目で確認でき、どのような問題が発生したかを識別して改善できるようにトランザクションとトレース情報を提供します。

### チャート {#trace-multi-tx-chart}

<ImgLang img='multi-tx-cht.png' desc='チャート' />

<Cmdname sid="TTL06377" className="uitext" />タブの基本画面は<Cmdname sid="BTN07120" className="uitext" />です。<Cmdname sid="BTN07120" className="uitext" />は、各トランザクションの呼び出し関係を迅速かつ明確にユーザに提供します。同じ<Cmdname sid="TTL06107" className="uitext" />を持つトランザクションサービスの個別の実行時間を確認できます。トランザクションノードの背景色で表現されている所要時間(![数字1](/img/number-01.png) <Cmdname sid="time_bar" className="uitext" />)を通じて、トランザクション間の呼び出し関係を確認できます。<Cmdname sid="BTN07120" className="uitext" />では、マウスを利用して希望の位置に移動したり、スクロールを通じて拡大と縮小することができます。

- ![フィルターアイコン](/img/ico-filter.svg)<Cmdname sid="TLT06410" className="uitext" />：チャートに表示されるプロジェクトを選択または解除できます。

- ![設定アイコン](/img/ico-setting.svg)<Cmdname sid="TLT06411" className="uitext" />：チャートに表示するアイテムを表示または非表示します。

  - <Cmdname sid="time_bar" className="uitext" />：各ノードに所要時間(<Cmdname sid="time_bar" className="uitext" />)を表示または非表示します。

  - <Cmdname sid="application_name" className="uitext" />：各ノードにエージェント名(oname)を表示または非表示します。

  - <Cmdname sid="project" className="uitext" />：各ノードにプロジェクト名を表示または非表示します。

  - <Cmdname sid="database" className="uitext" />／<Cmdname sid="apply_external_remote" className="uitext" />／<Cmdname sid="apply_internal_remote" className="uitext" />：トランザクションで発生した他のデータベースコネクションの要求やHTTP Callの情報もチャートのノードで確認できます。

トランザクションノードを選択すると、次のように<Cmdname sid="TTL06527" className="uitext" />ウィンドウが追加で表示されます。トランザクショントレースにより、そのトランザクションの詳細を確認できます。<Cmdname sid="TTL06527" className="uitext" />ウィンドウを使用したトランザクショントレースの詳細な分析に関する詳細は、[次の文書](trs-profile#transaction-info)を参照してください。

<ImgLang img='multi-tx-additional-info.png' desc='マルチトランザクションの詳細を見る' />

### 表 {#trace-multi-tx-table}

<Cmdname sid="BTN07121" className="uitext" />ボタンをクリックすると、テーブル形式でマルチトランザクション内に含まれる各トランザクションごとの情報を確認できます。

<ImgLang img='multi-tx-table-mode.png' desc='マルチトランザクションテーブルモード' />

- ![フィルターアイコン](/img/ico-filter.svg)<Cmdname sid="TLT06410" className="uitext" />：チャートに表示されるプロジェクトを選択または解除できます。

- ![カラムアイコン](/img/ic-column.svg) <Cmdname sid="BTN06441" className="uitext" />：テーブルのカラムを編集できます。 

各トランザクション項目を選択すると、<Cmdname sid="BTN07120" className="uitext" />タブでノードを選択するのと同様に、選択したトランザクションに対する<Cmdname sid="TTL06527" className="uitext" />画面が表示されます。トランザクショントレースにより、そのトランザクションの詳細を確認できます。<Cmdname sid="TTL06527" className="uitext" />画面を活用したトランザクショントレースの詳細な分析に関する詳細は、[次の文書](trs-profile#transaction-info)を参照してください。

### ツリー {#trace-multi-tx-tree}

<Cmdname sid="BTN06296" className="uitext" />ボタンをクリックすると、各トランザクションとそれに属しているトレースの詳細を確認できます。トランザクションの所要時間内の各サブトランザクションまたはトレースの開始および所要時間を可視化し、トランザクション呼び出し関係をツリー形式で提供します。

<ImgLang img='multi-tx-tree-mode.png' desc='マルチトランザクションツリーモード' />

- ![フィルターアイコン](/img/ico-filter.svg)<Cmdname sid="TLT06410" className="uitext" />：チャートに表示されるプロジェクトを選択または解除できます。

- ![一行表示アイコン](/img/ic-single-line.svg) <Cmdname sid="BTN06368" className="uitext" />：各区間ごとの実行情報に表示されたテキストを一行で表示し、ツリー形式を簡潔にまとめられます。

- ![複数行表示アイコン](/img/ic-multi-line.svg) <Cmdname sid="BTN06369" className="uitext" />：各区間ごとの実行情報に表示されたテキストを改行してすべて表示します。

- <Cmdname sid="BTN06327" className="uitext" />：最長の経路で移動できます。

- ![チャートアイコン](/img/ic-bar-chart.svg) <Cmdname sid="BTN06743" className="uitext" />：経過時間を棒チャートで表示します。

- ![時間アイコン](/img/ic-custom-time.svg) <Cmdname sid="BTN06744" className="uitext" />：各区間別のタイムスタンプ、ギャップ、経過時間をテキスト形式で表示します。

  - 8秒以上：<span class='etrs'>超過した</span>状態で<span class='etrs'>赤色</span>で表現します。

  - 3秒以上8秒未満：<span class='ov5ud10'>遅延</span>状態で<span class='ov5ud10'>オレンジ</span>で表現します。

  - 3秒未満：<span class='woer'>正常な</span>状態で<span class='woer'>青色</span>で表示します。

  :::note

  開始および所要時間の場合、トランザクション呼び出し環境によって生じる時差を上位トランザクションのトレースやマッピングで修正および表示することで、実際に収集された時間データとの差異が生じる可能性があります。

  :::

- ![非表示アイコン](/img/ic-eye-invisible.svg) <Cmdname sid="BTN06745" className="uitext" />：時間情報を非表示にします。

:::note

- 当該トレースの![統計アイコン](/img/ic-static.svg)ボタンまたは![ポップアップアイコン](/img/ic-popup.svg)ボタンを選択すると、<Cmdname sid="remote_http_call_statistics" className="uitext" />および<Cmdname sid="activestack" className="uitext" />、<UI>SQL</UI>などの詳細情報を確認できます。

- SQLステップの![コピーアイコン](/img/ico-copy.svg)ボタンを選択すると、そのステップのSQL文をコピーできます。

:::
