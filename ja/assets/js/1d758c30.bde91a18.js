"use strict";(self.webpackChunkWhaTap_Docs=self.webpackChunkWhaTap_Docs||[]).push([["78001"],{4198:function(n,e,t){t.r(e),t.d(e,{metadata:()=>r,contentTitle:()=>s,default:()=>d,assets:()=>c,toc:()=>h,frontMatter:()=>o});var r=JSON.parse('{"id":"release-notes/golang/golang-0_1_12","title":"Go Agent v0.1.12","description":"\u30EA\u30EA\u30FC\u30B9\uFF1A2022-08-02","source":"@site/i18n/ja/docusaurus-plugin-content-docs/current/release-notes/golang/golang-0.1.12.mdx","sourceDirName":"release-notes/golang","slug":"/release-notes/golang/golang-0_1_12","permalink":"/ja/release-notes/golang/golang-0_1_12","draft":false,"unlisted":false,"editUrl":"undefined/docs/release-notes/golang/golang-0.1.12.mdx","tags":[],"version":"current","frontMatter":{"id":"golang-0_1_12","title":"Go Agent v0.1.12","toc_max_heading_level":2,"displayed_sidebar":"releaseSidebar","isTranslationMissing":false},"sidebar":"releaseSidebar"}'),a=t("85893"),i=t("50065");t("37016"),t("13348");let o={id:"golang-0_1_12",title:"Go Agent v0.1.12",toc_max_heading_level:2,displayed_sidebar:"releaseSidebar",isTranslationMissing:!1},s=void 0,c={},h=[{value:"\u30D9\u30FC\u30BF\u7248 - \u30A2\u30C3\u30D7\u30C7\u30FC\u30C8",id:"\u30D9\u30FC\u30BF\u7248---\u30A2\u30C3\u30D7\u30C7\u30FC\u30C8",level:2},{value:"alpine linux\u306B\u5BFE\u5FDC\u3057\u307E\u3059\u3002",id:"alpine-linux\u306B\u5BFE\u5FDC\u3057\u307E\u3059",level:3},{value:"\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u65B9\u6CD5",id:"\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u65B9\u6CD5",level:4},{value:"whatap-agent\u5B9F\u884C",id:"whatap-agent\u5B9F\u884C",level:4},{value:"github.com/go-chi/chi\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",id:"githubcomgo-chichi\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",level:3},{value:"\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u65B9\u6CD5",id:"\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u65B9\u6CD5-1",level:4},{value:"github.com/go-gorm/gorm\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",id:"githubcomgo-gormgorm\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",level:3},{value:"whatapgorm\u306E\u4F7F\u7528\u65B9\u6CD5",id:"whatapgorm\u306E\u4F7F\u7528\u65B9\u6CD5",level:4},{value:"whatapsql\u306E\u4F7F\u7528\u65B9\u6CD5",id:"whatapsql\u306E\u4F7F\u7528\u65B9\u6CD5",level:4},{value:"github.com/jinzhu/gorm\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",id:"githubcomjinzhugorm\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",level:3},{value:"whatapgorm\u306E\u4F7F\u7528\u65B9\u6CD5",id:"whatapgorm\u306E\u4F7F\u7528\u65B9\u6CD5-1",level:4},{value:"whatapsql\u306E\u4F7F\u7528\u65B9\u6CD5",id:"whatapsql\u306E\u4F7F\u7528\u65B9\u6CD5-1",level:4},{value:"github.com/gomodule/redigo\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",id:"githubcomgomoduleredigo\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",level:3},{value:"github.com/shopify/sarama\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",id:"githubcomshopifysarama\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",level:3},{value:"async producer\u8FFD\u8DE1",id:"async-producer\u8FFD\u8DE1",level:4},{value:"consumer\u8FFD\u8DE1",id:"consumer\u8FFD\u8DE1",level:4}];function l(n){let e={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",section:"section",...(0,i.a)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:"\u30EA\u30EA\u30FC\u30B9\uFF1A2022-08-02"}),"\n",(0,a.jsx)(e.section,{className:"remark-sectionize-h2",children:(0,a.jsx)(e.h2,{id:"\u30D9\u30FC\u30BF\u7248---\u30A2\u30C3\u30D7\u30C7\u30FC\u30C8",children:"\u30D9\u30FC\u30BF\u7248 - \u30A2\u30C3\u30D7\u30C7\u30FC\u30C8"})}),"\n",(0,a.jsx)(e.section,{className:"remark-sectionize-h3",children:(0,a.jsx)(e.h3,{id:"alpine-linux\u306B\u5BFE\u5FDC\u3057\u307E\u3059",children:"alpine linux\u306B\u5BFE\u5FDC\u3057\u307E\u3059\u3002"})}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u65B9\u6CD5",children:"\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u65B9\u6CD5"}),(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.a,{href:"https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz",children:"whatap-agent.tar.gz"}),"\u3092\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u3057\u3066\u300C/\u300D\u30C7\u30A3\u30EC\u30AF\u30C8\u30EA\u306B\u5727\u7E2E\u3092\u89E3\u51CD\u3057\u307E\u3059\u3002_/usr/whatap/agent_\u30C7\u30A3\u30EC\u30AF\u30C8\u30EA\u306B\u30E2\u30CB\u30BF\u30EA\u30F3\u30B0\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u30D5\u30A1\u30A4\u30EB\u304C\u751F\u6210\u3055\u308C\u307E\u3059\u3002"]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz\ntar -xvzf whatap-agent.tar.gz -C /\n"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatap-agent\u5B9F\u884C",children:"whatap-agent\u5B9F\u884C"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"/usr/whatap/agent/whatap-agent \n    Default restart\n    Command start, stop, restart, version\n\n## \u30D0\u30FC\u30B8\u30E7\u30F3\u78BA\u8A8D\n# /usr/whatap/agent/whatap-agent version\n0.8.5.20201209\n\n## \u5B9F\u884C\u78BA\u8A8D\n# ps -elf | grep whatap\n  103 root      0:05 ./whatap_agent_static -t=4\n"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomgo-chichi\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",children:"github.com/go-chi/chi\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC"}),(0,a.jsxs)(e.p,{children:["chi\u30D5\u30EC\u30FC\u30E0\u30EF\u30FC\u30AF\u306E\u30A6\u30A7\u30D6\u30C8\u30E9\u30F3\u30B6\u30AF\u30B7\u30E7\u30F3\u3092\u8FFD\u8DE1\u3057\u307E\u3059\u3002",(0,a.jsx)(e.code,{children:"Use"}),"\u95A2\u6570\u3067\u30DF\u30C9\u30EB\u30A6\u30A7\u30A2\u3092\u767B\u9332\u3057\u3066\u8FFD\u8DE1\u3057\u307E\u3059\u3002"]})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u65B9\u6CD5-1",children:"\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u65B9\u6CD5"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",children:'import (\n  "github.com/go-chi/chi"\n  "github.com/whatap/go-api/trace"\n  "github.com/whatap/go-api/instrumentation/github.com/go-chi/chi/whatapchi"\n)\n\nfunc main() {\n  config := make(map[string]string)\n  trace.Init(config)\n  defer trace.Shutdown()\n  \n  r := chi.NewRouter()\n  \n  // whatapchi\u306Emiddleware\u3092\u767B\u9332\u3057\u307E\u3059\u3002\n  r.Use(whatapchi.Middleware)\n  \n  r.Get("/", func(w http.ResponseWriter, r *http.Request) {\n      fmt.Println("Response -", r.Response)\n})\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/go-chi/chi",children:"\u53C2\u8003\u4F8B"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomgo-gormgorm\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",children:"github.com/go-gorm/gorm\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC"}),(0,a.jsx)(e.p,{children:"gorm v2\u30D5\u30EC\u30FC\u30E0\u30EF\u30FC\u30AF\u3092\u4F7F\u7528\u3057\u3066\u51E6\u7406\u3055\u308C\u308BDB Connection\u304A\u3088\u3073SQL\u3092\u8FFD\u8DE1\u3057\u307E\u3059\u3002"})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatapgorm\u306E\u4F7F\u7528\u65B9\u6CD5",children:"whatapgorm\u306E\u4F7F\u7528\u65B9\u6CD5"}),(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"gorm.Open"}),"\u95A2\u6570\u306E\u4EE3\u308F\u308A\u306B",(0,a.jsx)(e.code,{children:"whatapgorm.OpenWithContext"}),"\u95A2\u6570\u3092\u4F7F\u7528\u3057\u307E\u3059\u3002\u53D7\u3051\u6E21\u3059context\u306F\u3001\u5185\u90E8\u306Bwhatap TraceCtx\u3092\u542B\u307E\u308C\u3066\u3044\u308B\u5FC5\u8981\u304C\u3042\u308A\u3001trace\u30D1\u30C3\u30B1\u30FC\u30B8\u306E",(0,a.jsx)(e.code,{children:"Start"}),"\u95A2\u6570\u3092\u4F7F\u7528\u3057\u3066\u751F\u6210\u3059\u308B\u3053\u3068\u304C\u3067\u304D\u307E\u3059\u3002"]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "net/http"\n\n  "github.com/whatap/go-api/instrumentation/github.com/go-gorm/gorm/whatapgorm"\n  "github.com/whatap/go-api/trace"\n  "gorm.io/driver/sqlite"\n  "gorm.io/gorm"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/InsertAndDelete", func(w http.ResponseWriter, r *http.Request) {\n    // Context\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whatapgorm\u3067DB\u3068\u63A5\u7D9A\u3057\u307E\u3059\u3002\n    db, err := whatapgorm.OpenWithContext(sqlite.Open("test.db"), &gorm.Config{}, ctx)\n    if err != nil {\n      panic("Db\u63A5\u7D9A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")\n    }\n\n    for i := 0; i < 100; i++ {\n      db.Create(&Product{Code: i, Price: i * 100})\n    }\n\n    db.Unscoped().Delete(&Product{}, "Code >= ? AND Code < ?", 0, 100)\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatapsql\u306E\u4F7F\u7528\u65B9\u6CD5",children:"whatapsql\u306E\u4F7F\u7528\u65B9\u6CD5"}),(0,a.jsx)(e.p,{children:"gorm\u306F\u516C\u5F0F\u5BFE\u5FDC\u3059\u308Bsqlite\u3001mysql\u3001postgres\u3001sqlserver\u306Edialect interface\u30D9\u30FC\u30B9\u3067\u4F5C\u6210\u3055\u308C\u305Fdirver\u3068\u4E92\u63DB\u6027\u304C\u3042\u308A\u307E\u3059\u3002"}),(0,a.jsxs)(e.p,{children:["\u95A2\u9023\u30EA\u30F3\u30AF\uFF1A",(0,a.jsx)(e.a,{href:"https://gorm.io/docs/write_driver.html",children:"gorm driver"})]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "net/http"\n  "github.com/whatap/go-api/instrumentation/database/sql/whatapsql"\n  "github.com/whatap/go-api/trace"\n  "gorm.io/driver/mysql"\n  "gorm.io/gorm"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/WhatapDriverTest", func(w http.ResponseWriter, r *http.Request) {\n    // Context\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whatapsql driver\u3067db connection\u3092\u751F\u6210\u3057\u307E\u3059\u3002\n    dbConn, err := whatapsql.OpenContext(ctx, "mysql", dataSource)\n    \n    // \u65E2\u306B\u751F\u6210\u3055\u308C\u305Fconnection\u3092\u901A\u3058\u3066gorm\u306B\u63A5\u7D9A\u3057\u307E\u3059\u3002\n    db, err := gorm.Open(mysql.New(mysql.Config{Conn: dbConn}), &gorm.Config{})\n    if err != nil {\n      panic("Db\u63A5\u7D9A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")\n    }\n    \n    for i := 0; i < 100; i++ {\n      db.Create(&Product{Code: i, Price: i * 100})\n    }\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/go-orm/gorm",children:"\u53C2\u8003\u4F8B"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomjinzhugorm\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",children:"github.com/jinzhu/gorm\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC"}),(0,a.jsx)(e.p,{children:"gorm v1\u30D5\u30EC\u30FC\u30E0\u30EF\u30FC\u30AF\u3092\u4F7F\u7528\u3057\u3066\u51E6\u7406\u3055\u308C\u308BDB Connection\u304A\u3088\u3073SQL\u3092\u8FFD\u8DE1\u3057\u307E\u3059\u3002"})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatapgorm\u306E\u4F7F\u7528\u65B9\u6CD5-1",children:"whatapgorm\u306E\u4F7F\u7528\u65B9\u6CD5"}),(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"gorm.Open"}),"\u95A2\u6570\u306E\u4EE3\u308F\u308A\u306B",(0,a.jsx)(e.code,{children:"whatapgorm.OpenWithContext"}),"\u95A2\u6570\u3092\u4F7F\u7528\u3057\u307E\u3059\u3002\u53D7\u3051\u6E21\u3059context\u306F\u3001\u5185\u90E8\u306Bwhatap TraceCtx\u3092\u542B\u3081\u308B\u5FC5\u8981\u304C\u3042\u308A\u3001trace\u30D1\u30C3\u30B1\u30FC\u30B8\u306EStart\u95A2\u6570\u3092\u4F7F\u7528\u3057\u3066\u751F\u6210\u3059\u308B\u3053\u3068\u304C\u3067\u304D\u307E\u3059\u3002"]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "net/http"\n\n  "github.com/whatap/go-api/instrumentation/github.com/go-gorm/gorm/whatapgorm"\n  "github.com/whatap/go-api/trace"\n  _ "github.com/mattn/go-sqlite3"\n  "github.com/jinzhu/gorm"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/InsertAndDelete", func(w http.ResponseWriter, r *http.Request) {\n    // Context\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whatapgorm\u3067DB\u3068\u63A5\u7D9A\u3057\u307E\u3059\u3002\n    db, err := whatapgorm.OpenWithContext(ctx, "sqlite3", "test.db")\n    defer db.Close()\n    if err != nil {\n      trace.Error(ctx, err)\n      panic("Gorm Open Fail")\n    }\n\n    for i := 0; i < 100; i++ {\n      db.Create(&Product{Code: i, Price: i * 100})\n    }\n\n    db.Unscoped().Delete(Product{}, "Code >= ? AND Code < ?", 0, 100)\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"whatapsql\u306E\u4F7F\u7528\u65B9\u6CD5-1",children:"whatapsql\u306E\u4F7F\u7528\u65B9\u6CD5"}),(0,a.jsx)(e.p,{children:"gorm\u306F\u516C\u5F0F\u5BFE\u5FDC\u3059\u308Bsqlite\u3001mysql\u3001postgres\u3001sqlserver\u306Edialect interface\u30D9\u30FC\u30B9\u3067\u4F5C\u6210\u3055\u308C\u305Fdirver\u3068\u4E92\u63DB\u6027\u304C\u3042\u308A\u307E\u3059\u3002"}),(0,a.jsxs)(e.p,{children:["\u95A2\u9023\u30EA\u30F3\u30AF\uFF1A",(0,a.jsx)(e.a,{href:"https://v1.gorm.io/docs/dialects.html",children:"gorm driver"})]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "net/http"\n  "github.com/whatap/go-api/instrumentation/database/sql/whatapsql"\n  "github.com/whatap/go-api/trace"\n  "github.com/jinzhu/gorm"\n_ "github.com/go-sql-driver/mysql"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/WhatapDriverTest", func(w http.ResponseWriter, r *http.Request) {\n    //Context\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whatapsql driver\u3067db connection\u3092\u751F\u6210\u3057\u307E\u3059\u3002\n    var conn gorm.SQLCommon\n    var err error\n    conn, err = whatapsql.OpenContext(ctx, "mysql", dataSource)\n    if err != nil {\n      trace.Error(ctx, err)\n      panic("Whatapsql Open Fail")\n    }\n    \n    // \u65E2\u306B\u751F\u6210\u3055\u308C\u305Fconnection\u3092\u4F7F\u7528\u3057\u3066gorm\u306B\u63A5\u7D9A\u3057\u307E\u3059\u3002\n    db, err := gorm.Open("mysql", conn)\n    if err != nil {\n      trace.Error(ctx, err)\n      panic("Gorm Open Fail")\n    }\n    for i := 0; i < 100; i++ {\n      db.Create(&Product{Code: i, Price: i * 100})\n    }\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/jinzhu/gorm",children:"\u53C2\u8003\u4F8B"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomgomoduleredigo\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",children:"github.com/gomodule/redigo\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC"}),(0,a.jsxs)(e.p,{children:["redigo\u30D5\u30EC\u30FC\u30E0\u30EF\u30FC\u30AF\u3092\u4F7F\u7528\u3057\u3066redis\u306B\u53D7\u3051\u6E21\u3055\u308C\u308B\u30B3\u30DE\u30F3\u30C9\u3092\u8FFD\u8DE1\u3057\u307E\u3059\u3002",(0,a.jsx)(e.code,{children:"redis.Dial"}),"\u306E\u4EE3\u308F\u308A\u306B",(0,a.jsx)(e.code,{children:"whatapredigo.DialContext"}),"\u306E\u95A2\u6570\u3092\u4F7F\u7528\u3057\u307E\u3059\u3002"]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "context"\n  "net/http"\n\n  "github.com/gomodule/redigo/redis"\n  "github.com/whatap/go-api/instrumentation/github.com/gomodule/redigo/whatapredigo"\n  "github.com/whatap/go-api/trace"\n)\n\nfunc main() {\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  http.HandleFunc("/SetAndGetWithDialContext", func(w http.ResponseWriter, r *http.Request) {\n    // Context\u3092\u4F5C\u6210\u3057\u307E\u3059\u3002\n    ctx, _ := trace.StartWithRequest(r)\n    defer trace.End(ctx, nil)\n\n    // whtapredigo\u3092\u4F7F\u7528\u3057\u3066redis connection\u3092\u751F\u6210\u3057\u307E\u3059\u3002\n    conn, err := whatapredigo.DialContext(ctx, "tcp", "127.0.0.1:6379")\n    if err != nil {\n      trace.Error(ctx, err)\n      return\n    }\n    defer conn.Close()\n\n    _, err = conn.Do("SET", "DataKey", "DataValue")\n    if err != nil {\n      trace.Error(ctx, err)\n      return\n    }\n\n    data, err := redis.Bytes(conn.Do("GET", "DataKey"))\n    if err != nil {\n      trace.Error(ctx, err)\n      return\n    }\n  })\n}\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/gomodule/redigo",children:"\u53C2\u8003\u4F8B"})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h3",children:[(0,a.jsx)(e.h3,{id:"githubcomshopifysarama\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC",children:"github.com/shopify/sarama\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u5BFE\u5FDC"}),(0,a.jsx)(e.p,{children:"sarama\u30D5\u30EC\u30FC\u30E0\u30EF\u30FC\u30AF\u3092\u4F7F\u7528\u3057\u3066\u51E6\u7406\u3055\u308C\u308Bkafka produce\u3001consume\u30A4\u30D9\u30F3\u30C8\u3092\u8FFD\u8DE1\u3057\u307E\u3059\u3002"})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"async-producer\u8FFD\u8DE1",children:"async producer\u8FFD\u8DE1"}),(0,a.jsx)(e.p,{children:"whatapsarama\u306EInterceptor\u3092\u4F7F\u7528\u3057\u3066async producer\u60C5\u5831\u3092\u8FFD\u8DE1\u3057\u307E\u3059\u3002Producer Message\u306E\u4F5C\u6210\u6642\u306B\u3001Ctx\u95A2\u9023\u60C5\u5831\u3092Metadata\u3092\u4F7F\u7528\u3057\u3066\u53D7\u3051\u6E21\u3059\u3068\u3001Multi Transaction\u306B\u63A5\u7D9A\u3055\u308C\u307E\u3059\u3002"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "context"\n  "net/http"\n  "github.com/Shopify/sarama"\n  "github.com/whatap/go-api/instrumentation/github.com/Shopify/sarama/whatapsarama"\n  "github.com/whatap/go-api/trace"\n)\n\nfunc main() {\n  config := sarama.NewConfig()\n  brokers := []string{"127.0.0.1:9092"} //config kafka broker IP/Port\n\n  // whatapsarama\u306E\u5272\u308A\u8FBC\u307F\u3092config\u306B\u767B\u9332\u3057\u307E\u3059\u3002\n  interceptor := whatapsarama.Interceptor{Brokers: brokers}\n  config.Producer.Interceptors = []sarama.ProducerInterceptor{&interceptor}\n\n  whatapConfig := make(map[string]string)\n  trace.Init(whatapConfig)\n  defer trace.Shutdown()\n\n  // Prdoducer\u751F\u6210\u6642\u306Bconfig\u3092\u53D7\u3051\u6E21\u3057\u307E\u3059\u3002\n  producer, err := sarama.NewAsyncProducer(brokers, config)\n  consumerOffset := sarama.OffsetOldest\n  if err != nil {\n    panic(err)\n  }\n  defer func() {\n    if err := producer.Close(); err != nil {\n      panic(err)\n    }\n  }()\n\n  http.HandleFunc("/AsyncProduceInput", func(w http.ResponseWriter, r *http.Request) {\n    ctx, _ := trace.StartWithRequest(r)\n    defer func() {\n      trace.End(ctx, nil)\n    }()\n    msg := &sarama.ProducerMessage{\n      Topic:    "tmp-topic",\n      Key:      sarama.StringEncoder("Data Key"),\n      Value:    sarama.StringEncoder("Data Value"),\n      Metadata: trace.GetMTrace(ctx),\n    }\n    producer.Input() <- msg //error check\n\n  })\n\n  _ = http.ListenAndServe(fmt.Sprintf(":%d", port), nil)\n}\n'})})]}),"\n",(0,a.jsxs)(e.section,{className:"remark-sectionize-h4",children:[(0,a.jsx)(e.h4,{id:"consumer\u8FFD\u8DE1",children:"consumer\u8FFD\u8DE1"}),(0,a.jsx)(e.p,{children:"whatapsarama\u306EInterceptor\u3092\u4F7F\u7528\u3057\u3066consumer\u60C5\u5831\u3092\u8FFD\u8DE1\u3057\u307E\u3059\u3002Produce\u304B\u3089\u6E21\u3055\u308C\u305FMessage\u3092\u57FA\u6E96\u306BMulti Transaction\u306B\u63A5\u7D9A\u3055\u308C\u307E\u3059\u3002"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-go",metastring:"title='Install guide'",children:'import (\n  "context"\n  "flag"\n  "fmt"\n  "net/http"\n  "text/template"\n\n  "github.com/Shopify/sarama"\n  "github.com/whatap/go-api/instrumentation/github.com/Shopify/sarama/whatapsarama"\n  "github.com/whatap/go-api/trace"\n)\n\nfunc main() {\n  config := sarama.NewConfig()\n  brokers := []string{"127.0.0.1:9092"} //config kafka broker IP/Port\n\n  // whatapsarama\u306E\u5272\u308A\u8FBC\u307F\u3092config\u306B\u767B\u9332\u3057\u307E\u3059\u3002\n  interceptor := whatapsarama.Interceptor{Brokers: brokers}\n  config.Consumer.Interceptors = []sarama.ConsumerInterceptor{&interceptor}\n\n  // consume 1\u56DE\u3042\u305F\u308A1tx\n  // Consumer\u751F\u6210\u6642\u306Bconfig\u3092\u4F1D\u9054\u53D7\u3051\u6E21\u3057\u307E\u3059\u3002\n  consumer, err := sarama.NewConsumer(brokers, config)\n  topic := "tmp-topic"\n\n  partitions, _ := consumer.Partitions(topic)\n  consume, _ := consumer.ConsumePartition(topic, partitions[0], consumerOffset)\n\n  if consume == nil {\n    fmt.Println("consume nil")\n    return\n  }\n\n  go func() {\n    for {\n      select {\n      case msg := <-consume.Messages():\n        fmt.Println(msg)\n      case consumerError := <-consume.Errors():\n        fmt.Println("error", consumerError)\n        return\n      }\n    }\n  }()\n}\n'})}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"https://github.com/whatap/go-api-example/tree/main/github.com/shopify/sarama",children:"\u53C2\u8003\u4F8B"})})]})]})}function d(n={}){let{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(l,{...n})}):l(n)}},37016:function(n,e,t){t.d(e,{Z:function(){return a}});var r=t(85893);function a(n){let{children:e,priority:t}=n;return t?(0,r.jsx)("code",{className:e,type:t,children:e}):(0,r.jsx)("code",{className:e,children:e})}t(67294)},13348:function(n,e,t){t.d(e,{Z:function(){return a}});var r=t(85893);function a(n){let{children:e}=n;return(0,r.jsx)("span",{className:"uitext",children:e})}t(67294)},50065:function(n,e,t){t.d(e,{Z:function(){return s},a:function(){return o}});var r=t(67294);let a={},i=r.createContext(a);function o(n){let e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:o(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);