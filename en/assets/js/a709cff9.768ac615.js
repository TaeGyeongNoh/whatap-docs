"use strict";(self.webpackChunkWhaTap_Docs=self.webpackChunkWhaTap_Docs||[]).push([["16516"],{3858:function(e,n,t){t.r(n),t.d(n,{metadata:()=>a,contentTitle:()=>s,default:()=>d,assets:()=>l,toc:()=>c,frontMatter:()=>r});var a=JSON.parse('{"id":"kubernetes/install-docker-python","title":"Installing Docker Python","description":"This step allows you to install the agent to monitor Python applications in the container.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/kubernetes/install-docker-python.mdx","sourceDirName":"kubernetes","slug":"/kubernetes/install-docker-python","permalink":"/en/kubernetes/install-docker-python","draft":false,"unlisted":false,"editUrl":"undefined/docs/kubernetes/install-docker-python.mdx","tags":[],"version":"current","frontMatter":{"id":"install-docker-python","title":"Installing Docker Python","description":"This step allows you to install the agent to monitor Python applications in the container.","keywords":["Kubernetes","Kubernetes Monitoring","Application Installation","Python"],"isTranslationMissing":false},"sidebar":"kubeSidebar","previous":{"title":"Installing Docker Node.js","permalink":"/en/kubernetes/install-docker-nodejs"},"next":{"title":"Installing the docker PHP","permalink":"/en/kubernetes/install-docker-php"}}'),i=t("85893"),o=t("50065");t("47902"),t("5525");let r={id:"install-docker-python",title:"Installing Docker Python",description:"This step allows you to install the agent to monitor Python applications in the container.",keywords:["Kubernetes","Kubernetes Monitoring","Application Installation","Python"],isTranslationMissing:!1},s=void 0,l={},c=[{value:"Download agent",id:"download-agent",level:2},{value:"Configuration and execution of the agent",id:"configuration-and-execution-of-the-agent",level:2},{value:"Script running example",id:"script-running-example",level:3},{value:"Additional function",id:"additional-function",level:3},{value:"Configuring the container environment variables",id:"k8s-env",level:2},{value:"Checking the agent installation",id:"checking-the-agent-installation",level:2}];function h(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",ul:"ul",...(0,o.a)(),...e.components},{Details:t}=n;return!t&&function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["At the bottom of ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Management"})})," > ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Agent installation"})}),", click ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Install Application"})})," > Select the ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Docker Python"})})," tab in Install guide."]}),"\n",(0,i.jsx)(n.p,{children:"This process applies the WhaTap monitoring agent to the Python application running on the Docker container and packages the container image as follows. To release the Kubernetes application, the Docker image is required. Create a Docker image with the whatap-python package installed using the following process."}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.mdxAdmonitionTitle,{}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"EKS Fargate is to be supported later."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["To help you understand the Python application integration process, Git example codes are provided. See ",(0,i.jsx)(n.a,{href:"https://github.com/whatap/kuber-apm-boilerplate/tree/main/python/fastapi",children:"the following"}),"."]}),"\n"]}),"\n"]})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"download-agent",children:"Download agent"}),(0,i.jsx)(n.p,{children:"Install the whatap-python package when building your Python application docker image."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-docker",children:"RUN pip3 install --upgrade whatap-python\n"})}),(0,i.jsx)(n.p,{children:"See the following definition example of the following Dockerfile."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-docker",metastring:"title='python ver 3.10'",children:"# Install python3.10 In the Docker environment.\nFROM python:3.10\n\n# Set the working directory to /app.\nWORKDIR /app\n\n# Copy all the files and folers in the current directory to the /app directory in the container.\nADD . /app/\n\n# In Python, any external library can be installed using pip. \n# Install the WhaTap Python agent when building the docker image.\nRUN pip3 install --upgrade whatap-python\n"})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"configuration-and-execution-of-the-agent",children:"Configuration and execution of the agent"}),(0,i.jsxs)(n.p,{children:["Before running the application, determine the Python agent's working directory and then create a default configuration file. Pass the authentication information to the agent and set whether or not to trace logs through the configuration file (",(0,i.jsx)(n.em,{children:"entrypoint.sh"}),")."]}),(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Configuration file (entrypoint.sh) example"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:"title='entrypoint.sh'",children:'#!/bin/bash\n\n# Set the working directory of the container to the WhaTap path. The agent logs and configuration file are generated in the path.\nexport WHATAP_HOME=${PWD}\n\n# If any permission error occurs, remove the following comment.\n#chmod -R 777 $WHATAP_HOME\n\n# The following lists the settings required for agent configuration. Configure them through the yaml file for release of applications.\nwhatap-setting-config \\\n--host $whatap_server_host \\\n--license $license \\\n--app_name $app_name \\\n--app_process_name $app_process_name\n\n# The following comments are additionally configured for agent grouping and activation of log collection. Use them if necessary.\n\n# Agent grouping\n# echo "whatap.okind=$whatap.okind" >> whatap.conf\n\n# Activation of log collection\n#echo "logsink_enabled=true" >> whatap.conf\n#echo "logsink_trace_enabled=true" >> whatap.conf\n#echo "trace_logging_enabled=true" >> whatap.conf\n\n\n# Add whatap-start-agent before the application startup command to run the agent. \nwhatap-start-agent uvicorn server:app --host 0.0.0.0 --port 8000\n'})})]}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Set the container's working directory with the ",(0,i.jsx)(n.code,{children:"WHATAP_HOME"})," environment variable. Create the agent log and configuration files in the path."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export WHATAP_HOME=${PWD}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Execute the following command to create and configure the ",(0,i.jsx)(n.em,{children:"whatap.conf"})," file in the path set as ",(0,i.jsx)(n.code,{children:"WHATAP_HOME"}),". Variables marked with ",(0,i.jsx)(n.code,{children:"$"})," are required for agent configuration and are set through the ",(0,i.jsx)(n.em,{children:"yaml"})," file for releasing the application."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"whatap-setting-config \\\n--host $whatap_server_host \\\n--license $license \\\n--app_name $app_name \\\n--app_process_name $app_process_name\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Run the agent by adding ",(0,i.jsx)(n.code,{children:"whatap-start-agent"})," before the application startup command as follows:"]}),"\n"]}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"whatap-start-agent uvicorn server:app --host 0.0.0.0 --port 8000\n"})}),(0,i.jsxs)(n.admonition,{type:"caution",children:[(0,i.jsxs)(n.p,{children:["If any role issues, assign roles to the ",(0,i.jsx)(n.code,{children:"$WHATAP_HOME"})," variable as follows:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo `sudo chmod -R 777 $WHATAP_HOME`\n"})})]}),(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.mdxAdmonitionTitle,{}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["As an example of the ",(0,i.jsx)(n.em,{children:"yaml"})," file, see ",(0,i.jsx)(n.a,{href:"#k8s-env",children:"Container environment variable settings"})," as follows:"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"license"})," is the user authentication information of WhaTap. ",(0,i.jsx)(n.strong,{children:"Do not expose to outside"}),"."]}),"\n"]}),"\n"]})]})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"script-running-example",children:"Script running example"}),(0,i.jsxs)(n.p,{children:["See the following definition example of the following Dockerfile. This is a complete example to run the ",(0,i.jsx)(n.em,{children:"entrypoint.sh"})," script."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-docker",children:'FROM python:3.10\nWORKDIR /app\nADD . /app/\nRUN pip3 install --upgrade whatap-python \n\n# Assign a role to run the entrypoint.sh script in the container.\nRUN chmod +x ./entrypoint.sh\n\n# Execute the entrypoint.sh script when generating the container.\nCMD ["./entrypoint.sh"]\n'})})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(n.h3,{id:"additional-function",children:"Additional function"}),(0,i.jsxs)(n.p,{children:["The following settings are optional and must be used if necessary. In addition to the following additional settings in the configuration file (",(0,i.jsx)(n.em,{children:"entrypoint.sh"}),"), log and transaction-related settings are also configurable. For additional settings, see ",(0,i.jsx)(n.a,{href:"https://docs.whatap.io/python/set-agent",children:"the following"}),"."]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Agent grouping"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'echo "whatap.okind=$whatap.okind" >> whatap.conf\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Enabling the log collection"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'echo "logsink_enabled=true" >> whatap.conf\necho "logsink_trace_enabled=true" >> whatap.conf\necho "trace_logging_enabled=true" >> whatap.conf\n'})}),"\n"]}),"\n"]})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"k8s-env",children:"Configuring the container environment variables"}),(0,i.jsxs)(n.p,{children:["After building Docker, set ",(0,i.jsx)(n.strong,{children:"container environment variables"})," in the Kubernetes environment. Add the following items in the ",(0,i.jsx)(n.em,{children:"yaml"})," file for releasing the application."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"    env:\n    - name: license\n      value: XXXXXXXXXXXXXX-XXXXXXXXXXXXXX-XXXXXXXXXXXXXX\n    - name: whatap_server_host\n      value: XXX.XXX.XXX.XXX\n    - name: app_name\n      value: {YOUR_APP_NAME}\n    - name: app_process_name\n      value: {YOUR_PROCESS_NAME}\n    - name: whatap.okind\n      value: {YOUR_GROUP_NAME}\n    - name: NODE_IP\n      valueFrom: {fieldRef: {fieldPath: status.hostIP}}\n    - name: NODE_NAME\n      valueFrom: {fieldRef: {fieldPath: spec.nodeName}}\n    - name: POD_NAME\n      valueFrom: {fieldRef: {fieldPath: metadata.name}}\n"})}),(0,i.jsx)(n.p,{children:"See the following example:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: python-fastapi-deployment\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: python-fastapi-pod\n  template:\n    metadata:\n      labels:\n        app: python-fastapi-pod\n  containers:\n  - name: agent-python-fastapi\n    image: whatap/agent-python-fastapi\n    env:\n    - name: license\n      value: XXXXXXXXXXXXXX-XXXXXXXXXXXXXX-XXXXXXXXXXXXXX\n    - name: whatap_server_host\n      value: XXX.XXX.XXX.XXX\n    - name: app_name\n      value: "myapp-python-fastapi"\n    - name: app_process_name\n      value: "uvicorn"\n    - name: NODE_IP\n      valueFrom: {fieldRef: {fieldPath: status.hostIP}}\n    - name: NODE_NAME\n      valueFrom: {fieldRef: {fieldPath: spec.nodeName}}\n    - name: POD_NAME\n      valueFrom: {fieldRef: {fieldPath: metadata.name}}\n'})}),(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Roles of environment variables"})}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"license"}),": Key for agent authentication."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"whatap_server_host"}),": Host IP of the WhaTap collection server"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"app_name"}),": Name to identify the agent for the application. For more information about the agent identification, see ",(0,i.jsx)(n.a,{href:"https://docs.whatap.io/python/agent-name",children:"the following"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"app_process_name"}),": Set the target processes such as CPU and Heap Memory. For example, there are uwsgi and gunicorn."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"whatap.okind"})," (optional): Groups applications for the Pod. If set using the deployment name, the corresponding Pods are grouped together."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"NODE_IP"}),": Collects the IP address of the node where the current Pod has been hosted."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"NODE_NAME"}),": Collects the name of the node where the current Pod is running."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"POD_NAME"}),": Collects the name of the current Pod."]}),"\n"]}),"\n"]})]})]}),"\n",(0,i.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(n.h2,{id:"checking-the-agent-installation",children:"Checking the agent installation"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["To check whether the agent has been installed, go to ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Dashboard"})})," > ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.em,{children:"Application Service Dashboard"})}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Run the ",(0,i.jsx)(n.code,{children:"ps -ef | grep whatap_python"})," command in the container to check whether the Whatap Python service is running normally."]}),"\n"]}),"\n"]})]})]})}function d(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},5525:function(e,n,t){t.d(n,{Z:()=>r});var a=t("85893");t("67294");var i=t("67026");let o="tabItem_Ymn6";function r(e){let{children:n,hidden:t,className:r}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,i.Z)(o,r),hidden:t,children:n})}},47902:function(e,n,t){t.d(n,{Z:()=>v});var a=t("85893"),i=t("67294"),o=t("67026"),r=t("69599"),s=t("16550"),l=t("32000"),c=t("4520"),h=t("38341"),d=t("76009");function p(e){return i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||i.isValidElement(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){let{value:n,tabValues:t}=e;return t.some(e=>e.value===n)}var m=t("7227");let g="tabList__CuJ",f="tabItem_LNqP";function x(e){let{className:n,block:t,selectedValue:i,selectValue:s,tabValues:l}=e,c=[],{blockElementScrollPositionUntilNextRender:h}=(0,r.o5)(),d=e=>{let n=e.currentTarget,t=l[c.indexOf(n)].value;t!==i&&(h(n),s(t))},p=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let t=c.indexOf(e.currentTarget)+1;n=c[t]??c[0];break}case"ArrowLeft":{let t=c.indexOf(e.currentTarget)-1;n=c[t]??c[c.length-1]}}n?.focus()};return(0,a.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":t},n),children:l.map(e=>{let{value:n,label:t,attributes:r}=e;return(0,a.jsx)("li",{role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,ref:e=>c.push(e),onKeyDown:p,onClick:d,...r,className:(0,o.Z)("tabs__item",f,r?.className,{"tabs__item--active":i===n}),children:t??n},n)})})}function j(e){let{lazy:n,children:t,selectedValue:r}=e,s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){let e=s.find(e=>e.props.value===r);return e?(0,i.cloneElement)(e,{className:(0,o.Z)("margin-top--md",e.props.className)}):null}return(0,a.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==r}))})}function y(e){let n=function(e){let{defaultValue:n,queryString:t=!1,groupId:a}=e,o=function(e){let{values:n,children:t}=e;return(0,i.useMemo)(()=>{let e=n??p(t).map(e=>{let{props:{value:n,label:t,attributes:a,default:i}}=e;return{value:n,label:t,attributes:a,default:i}});return!function(e){let n=(0,h.lx)(e,(e,n)=>e.value===n.value);if(n.length>0)throw Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}(e),[r,m]=(0,i.useState)(()=>(function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!u({value:n,tabValues:t}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}let a=t.find(e=>e.default)??t[0];if(!a)throw Error("Unexpected error: 0 tabValues");return a.value})({defaultValue:n,tabValues:o})),[g,f]=function(e){let{queryString:n=!1,groupId:t}=e,a=(0,s.k6)(),o=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t}),r=(0,c._X)(o);return[r,(0,i.useCallback)(e=>{if(!o)return;let n=new URLSearchParams(a.location.search);n.set(o,e),a.replace({...a.location,search:n.toString()})},[o,a])]}({queryString:t,groupId:a}),[x,j]=function(e){var n;let{groupId:t}=e;let a=(n=t)?`docusaurus.tab.${n}`:null,[o,r]=(0,d.Nk)(a);return[o,(0,i.useCallback)(e=>{if(!!a)r.set(e)},[a,r])]}({groupId:a}),y=(()=>{let e=g??x;return u({value:e,tabValues:o})?e:null})();return(0,l.Z)(()=>{y&&m(y)},[y]),{selectedValue:r,selectValue:(0,i.useCallback)(e=>{if(!u({value:e,tabValues:o}))throw Error(`Can't select invalid tab value=${e}`);m(e),f(e),j(e)},[f,j,o]),tabValues:o}}(e);return(0,a.jsxs)("div",{className:(0,o.Z)("tabs-container",g),children:[(0,a.jsx)(x,{...n,...e}),(0,a.jsx)(j,{...n,...e})]})}function v(e){let n=(0,m.Z)();return(0,a.jsx)(y,{...e,children:p(e.children)},String(n))}},50065:function(e,n,t){t.d(n,{Z:function(){return s},a:function(){return r}});var a=t(67294);let i={},o=a.createContext(i);function r(e){let n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);