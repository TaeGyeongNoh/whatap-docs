"use strict";(self.webpackChunkWhaTap_Docs=self.webpackChunkWhaTap_Docs||[]).push([[2442],{12758:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>r});var t=a(74848),i=a(28453);const s={id:"install-agent-with-buildpack",title:"Installing the Java agent using the buildpack",description:"It guides you how to install the Java agent using the buildpack.",tags:["Java","Agent","Project","Application"],displayed_sidebar:"javaSidebar"},c=void 0,o={id:"java/install-agent-with-buildpack",title:"Installing the Java agent using the buildpack",description:"It guides you how to install the Java agent using the buildpack.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/java/install-agent-with-buildpack.mdx",sourceDirName:"java",slug:"/java/install-agent-with-buildpack",permalink:"/java/install-agent-with-buildpack",draft:!1,unlisted:!1,editUrl:"undefined/docs/java/install-agent-with-buildpack.mdx",tags:[{inline:!0,label:"Java",permalink:"/tags/java"},{inline:!0,label:"Agent",permalink:"/tags/agent"},{inline:!0,label:"Project",permalink:"/tags/project"},{inline:!0,label:"Application",permalink:"/tags/application"}],version:"current",frontMatter:{id:"install-agent-with-buildpack",title:"Installing the Java agent using the buildpack",description:"It guides you how to install the Java agent using the buildpack.",tags:["Java","Agent","Project","Application"],displayed_sidebar:"javaSidebar"},sidebar:"javaSidebar"},l={},r=[{value:"Basic settings of the WhaTap buildpack",id:"basic-settings-of-the-whatap-buildpack",level:2},{value:"Configuring options",id:"configuring-options",level:2},{value:"Tomcat 10 environment",id:"tomcat-10-environment",level:2},{value:"Container execution option",id:"container-execution-option",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",section:"section",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"If you are building an executable Docker image with the Java application using Gradle, you can use the buildpack to install the agent."}),"\n",(0,t.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,t.jsx)(n.h2,{id:"basic-settings-of-the-whatap-buildpack",children:"Basic settings of the WhaTap buildpack"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",metastring:"title='build.gradle'",children:'tasks.named("bootBuildImage") {\n\tbuildpacks = ["urn:cnb:builder:paketo-buildpacks/java",\t\n\t\t\t\t\t\t\t\t"docker.io/whatap/paketo-buildpack-apm"]\n}\n'})})]}),"\n",(0,t.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,t.jsx)(n.h2,{id:"configuring-options",children:"Configuring options"}),(0,t.jsxs)(n.p,{children:["Only when the WhaTap collection server is connected, data can be collected. The access key (",(0,t.jsx)(n.code,{children:"accesskey"}),") and WhaTap collection server address (",(0,t.jsx)(n.code,{children:"whatap.server.host"}),") are required. Additional options can be set according to the needs for the environment and functions."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",metastring:"title='build.gradle'",children:'tasks.named("bootBuildImage") {\n  // Whatap \n  environment["BP_WHATAP_ENABLED"] = "true"\n  // java 17, There must be a space at the beginning.\n  environment["BPE_APPEND_JAVA_TOOL_OPTIONS"] = " --add-opens=java.base/java.lang=ALL-UNNAMED "\n  // add multi options, delimeter is linefeed character\n  environment["BP_WHATAP_OPTIONS"] = "accesskey=aaa-bbb-ccc\\nwhatap.server.host=1.1.1.1/2.2.2.2"\n\n  buildpacks = ["urn:cnb:builder:paketo-buildpacks/java",\t"docker.io/whatap/paketo-buildpack-apm"]\n}\n'})}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"BP_WHATAP_ENABLED"})}),"\n",(0,t.jsxs)(n.p,{children:["Set whether or not to enable the WhaTap agent. If the value is ",(0,t.jsx)(n.code,{children:"false"}),", installation is performed but started with monitoring stopped. You can change it to ",(0,t.jsx)(n.code,{children:"true"})," in ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"Management"})}),"> ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"Agent CONF."})})," in ",(0,t.jsx)(n.a,{href:"https://service.whatap.io",children:"Whatap Monitoring Service"})," later."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"BPE_APPEND_JAVA_TOOL_OPTIONS"})}),"\n",(0,t.jsx)(n.p,{children:"If you are using Java 17 or later, add the JVM option."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'environment["BPE_DELIM_JAVA_TOOL_OPTIONS"] = " "\nenvironment["BPE_APPEND_JAVA_TOOL_OPTIONS"] = "--add-opens=java.base/java.lang=ALL-UNNAMED"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Add spaces before and after if you are not using the delimiter environment variable."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'environment["BPE_APPEND_JAVA_TOOL_OPTIONS"] = " --add-opens=java.base/java.lang=ALL-UNNAMED "\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"BP_WHATAP_OPTIONS"})}),"\n",(0,t.jsxs)(n.p,{children:['You can add the WhaTap agent settings. Set options with linefeed "\\n" as the delimiter. The option is ',(0,t.jsx)(n.code,{children:"key=value"}),". The set option values are saved in the ",(0,t.jsx)(n.code,{children:"whatap.conf"})," file during the Docker Image creation step."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'environment["BP_WHATAP_OPTIONS"] = "accesskey={access key}\\nwhatap.server.host={collection server address}"\n// Example: environment["BP_WHATAP_OPTIONS"] = "accesskey=aaa-bbb-ccc\\nwhatap.server.host=1.1.1.1/2.2.2.2"\n'})}),"\n"]}),"\n"]})]}),"\n",(0,t.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,t.jsx)(n.h2,{id:"tomcat-10-environment",children:"Tomcat 10 environment"}),(0,t.jsxs)(n.p,{children:["In the Tomcat environment, the ",(0,t.jsx)(n.code,{children:"weaving=tomcat10"})," option must be added."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'environment["BP_WHATAP_OPTIONS"] = "accesskey={access key}\\nwhatap.server.host={collection server address}\\nweaving=tomcat10"\n'})})]}),"\n",(0,t.jsxs)(n.section,{className:"remark-sectionize-h2",children:[(0,t.jsx)(n.h2,{id:"container-execution-option",children:"Container execution option"}),(0,t.jsx)(n.p,{children:"When running the container, you can set the access key and WhaTap collection server address as environment variables as follows."}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-docker",children:"docker run --rm -p 8080:8080 \\\n  -e accesskey={access key} \\\n  -e whatap.server.host={collection server address} \\\n  -e weaving=tomcat10,webflux-6.0 \\\n  spring-boot-gradle-hello-world-pcketo-buildpack-whatap\n"})})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>c,x:()=>o});var t=a(96540);const i={},s=t.createContext(i);function c(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);