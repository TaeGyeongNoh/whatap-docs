"use strict";(self.webpackChunkWhaTap_Docs=self.webpackChunkWhaTap_Docs||[]).push([[59993],{90277:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>a});var i=n(74848),r=n(28453);const s={id:"script-plugin",title:"Script plug-in",description:"The plugin option provided by the Java agent provides a way for you to inject desired code into the trace data or add additional information before and after execution of the method. It includes the options for setting where to run specific code at method entry/exit time and how to configure a class to monitor custom pools. More specific usages are provided through actual plug-in application cases, and it guides you to various configuration examples and API usage that can increase the flexibility and precision for monitoring.",tags:["Java","Agent","Script plugin"]},c=void 0,l={id:"java/script-plugin",title:"Script plug-in",description:"The plugin option provided by the Java agent provides a way for you to inject desired code into the trace data or add additional information before and after execution of the method. It includes the options for setting where to run specific code at method entry/exit time and how to configure a class to monitor custom pools. More specific usages are provided through actual plug-in application cases, and it guides you to various configuration examples and API usage that can increase the flexibility and precision for monitoring.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/java/script-plugin.mdx",sourceDirName:"java",slug:"/java/script-plugin",permalink:"/java/script-plugin",draft:!1,unlisted:!1,editUrl:"undefined/docs/java/script-plugin.mdx",tags:[{inline:!0,label:"Java",permalink:"/tags/java"},{inline:!0,label:"Agent",permalink:"/tags/agent"},{inline:!0,label:"Script plugin",permalink:"/tags/script-plugin"}],version:"current",frontMatter:{id:"script-plugin",title:"Script plug-in",description:"The plugin option provided by the Java agent provides a way for you to inject desired code into the trace data or add additional information before and after execution of the method. It includes the options for setting where to run specific code at method entry/exit time and how to configure a class to monitor custom pools. More specific usages are provided through actual plug-in application cases, and it guides you to various configuration examples and API usage that can increase the flexibility and precision for monitoring.",tags:["Java","Agent","Script plugin"]},sidebar:"javaSidebar",previous:{title:"HTTPC, API Call",permalink:"/java/agent-httpcapicall"},next:{title:"User count",permalink:"/java/agent-number-of-user"}},d={},a=[{value:"Plug-in options",id:"plug-in-options",level:2},{value:"Plug-in setting example",id:"plug-in-setting-example",level:2},{value:"Plug-in code writing example",id:"plug-in-code-writing-example",level:2},{value:"Writing the start time of the set method in the transaction trace",id:"writing-the-start-time-of-the-set-method-in-the-transaction-trace",level:3},{value:"Recording the set method&#39;s end time and execution time in the transaction trace",id:"recording-the-set-methods-end-time-and-execution-time-in-the-transaction-trace",level:3},{value:"Plug-in API",id:"plug-in-api",level:2},{value:"Provision of parameters - common plug-in files",id:"common-plugin",level:3},{value:"Parameters not provided - common plug-in file",id:"parameters-not-provided---common-plug-in-file",level:3},{value:"Daemon and batch",id:"daemon-and-batch",level:3},{value:"HTTP service",id:"http-service",level:3},{value:"HTTP Outbound",id:"http-outbound",level:3},{value:"Specific method",id:"specific-method",level:3},{value:"Custom pool",id:"custom-pool",level:3},{value:"Plug-in application example",id:"plug-in-application-example",level:2},{value:"Search request monitoring of the elastic search engine.",id:"search-request-monitoring-of-the-elastic-search-engine",level:3},{value:"Excluding the collection of transactions flowed into a specific IP",id:"excluding-the-collection-of-transactions-flowed-into-a-specific-ip",level:3},{value:"Atomikos pool monitoring",id:"atomikos-pool-monitoring",level:3},{value:"Presenting the cookie value in the transaction trace",id:"presenting-the-cookie-value-in-the-transaction-trace",level:3}];function o(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"The plugin option provided by the Java agent provides a way for you to inject desired code into the trace data or add additional information before and after execution of the method. It includes the options for setting where to run specific code at method entry/exit time and how to configure a class to monitor custom pools. More specific usages are provided through actual plug-in application cases, and it guides you to various configuration examples and API usage that can increase the flexibility and precision for monitoring."}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(t.h2,{id:"plug-in-options",children:"Plug-in options"}),(0,i.jsx)(t.p,{children:"The Java agent plug-in is executed by inserting in the method start and end. The locations (class, method) to apply the plug-in can be set as agent options."}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"hook_trace_helper_start_patterns"})}),"\n",(0,i.jsxs)(t.p,{children:["At the beginning of the method, set the point (class, method) where the trace plug-in is to be inserted. Write the plug-in code in the ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/TraceHelperStart.x"]})," file."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"hook_trace_helper_end_patterns"})}),"\n",(0,i.jsxs)(t.p,{children:["At the end of the method, set the point (class, method) where the trace plug-in is to be inserted. Write the plug-in code in the ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/TraceHelperEnd.x"]})," file."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"hook_trace_helper_patterns"})}),"\n",(0,i.jsxs)(t.p,{children:["At the beginning and end of the method, set the point (class, method) where the trace plug-in is to be inserted. Write the plug-in codes in the ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/TraceHelperStart.x"]})," and ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/TraceHelperEnd.x"]})," files."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"custom_pool_classes"})}),"\n",(0,i.jsxs)(t.p,{children:["To monitor the custom pool, set the class with the pool usage. Write the plug-in code in ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/CustomPool.x"]}),"."]}),"\n"]}),"\n"]})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(t.h2,{id:"plug-in-setting-example",children:"Plug-in setting example"}),(0,i.jsx)(t.p,{children:'In case of setting multiple classes, use the comma (,) as the delimiter. Part or all of the string of the package name can be replaced with "*."'}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"In case of setting the package and method name"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"whatap.bytecode.instrument.PluginTestA.testA,whatap.bytecode.instrument.PluginTestB.testB\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.strong,{children:["In case of replacing the package and method name with ",(0,i.jsx)(t.code,{children:"*"})]})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"*PluginTestA.testA,whatap.bytecode.instrument.PluginTestB.*\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"*.testA, *PluginTestB.testB\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"In case of targeting the whole"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"*.*\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"In case of setting the custom pool"})}),"\n",(0,i.jsx)(t.p,{children:"The custom pool is set in the form of identifier@package name."}),"\n",(0,i.jsxs)(t.p,{children:["For example, before the class name, set the identifier, ",(0,i.jsx)(t.code,{children:"whatap_plugin_guide"}),". Identifiers and classes are separated by @."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"whatap_plugin_guide@com.ibm.ws.connectionpool.monitor.ConnectionPoolStats \n"})}),"\n"]}),"\n"]})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(t.h2,{id:"plug-in-code-writing-example",children:"Plug-in code writing example"}),(0,i.jsx)(t.p,{children:"In most cases, the explicit type casting is required because objects are returned. The following examples are regarding the plug-in code writing."})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"writing-the-start-time-of-the-set-method-in-the-transaction-trace",children:"Writing the start time of the set method in the transaction trace"}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Write the method to apply in the Java agent's ",(0,i.jsx)(t.code,{children:"hook_trace_helper_patterns"})," option in ",(0,i.jsx)(t.em,{children:"whatap.conf"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ini",metastring:"title='$WHATAP_HOME/whatap.conf'",children:"hook_trace_helper_patterns=org.apache.catalina.connector.RequestFacade.*\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Write the plug-in code in ",(0,i.jsx)(t.em,{children:"TraceHelperStart.x"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:"title='$WHATAP_HOME/plugin/TraceHelperStart.x'",children:'// Substitute the class name and method name in the string prefix.\nString prefix = $point.class1 + "." + $point.method;\n// Set the WhaTap trace property name to `prefix` + "st" as the current time.\n$ctx.setAttribute(prefix + "st", new Long(System.currentTimeMillis()));\n// Add the current time in the trace information.\n$ctx.profile(prefix + " Start", new java.util.Date().toString()); \n'})}),"\n"]}),"\n"]}),(0,i.jsx)(t.p,{children:"Display the method start time in the transaction trace as follows."}),(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Start time recording trace history",src:n(71969).A+"",width:"456",height:"98"})})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"recording-the-set-methods-end-time-and-execution-time-in-the-transaction-trace",children:"Recording the set method's end time and execution time in the transaction trace"}),(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Write the method to apply in the Java agent's ",(0,i.jsx)(t.code,{children:"hook_trace_helper_patterns"})," option in ",(0,i.jsx)(t.em,{children:"whatap.conf"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ini",metastring:"title='$WHATAP_HOME/whatap.conf'",children:"hook_trace_helper_patterns=org.apache.catalina.connector.RequestFacade.*\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Write the plug-in code in ",(0,i.jsx)(t.em,{children:"TraceHelperEnd.x"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:"title='$WHATAP_HOME/plugin/TraceHelperEnd.x' {3,8} showLineNumbers",children:'String prefix = $point.class1 + "." + $point.method;\n// Import the trace attributes added in the TraceHelperStart.x file.\nlong st = ((Long) $ctx.getAttribute(prefix + "st")).longValue(); \nlong gap = System.currentTimeMillis() - st;\nStringBuilder sb = new StringBuilder();\nsb.append(new java.util.Date().toString() + " (Gap:" + gap + " milliseconds)");\n// Add the gap (execution time) between the start time and the current time to the trace information.\n$ctx.profile(prefix + " End", sb.toString()); \n'})}),"\n"]}),"\n"]}),(0,i.jsx)(t.p,{children:"It displays the method start time and execution time in the transaction trace as follows."}),(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Start/execution time recording trace history",src:n(41386).A+"",width:"456",height:"98"})})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(t.h2,{id:"plug-in-api",children:"Plug-in API"}),(0,i.jsxs)(t.p,{children:["The plug-in APIs are divided into common items: ",(0,i.jsx)(t.code,{children:"$ctx"}),", ",(0,i.jsx)(t.code,{children:"$point"}),", ",(0,i.jsx)(t.code,{children:"$req"}),", and ",(0,i.jsx)(t.code,{children:"$res"}),". Upon the transaction start/end, it can be applied in HTTPC section, specific method execution section, etc."]}),(0,i.jsx)(t.admonition,{type:"caution",children:(0,i.jsx)(t.p,{children:"It is prohibited to store personally identifiable information by using plug-in APIs. When collecting personal information, this must be clearly stated in the privacy policy."})})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"common-plugin",children:"Provision of parameters - common plug-in files"}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Parameter"}),(0,i.jsx)(t.th,{children:"Method/variable"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"22",style:{textAlign:"center"},children:"$ctx"}),(0,i.jsx)(t.td,{colSpan:"2",children:"Property management"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void setAttribute(String key, Object value)"}),(0,i.jsx)(t.td,{children:"It sets an attribute."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Object getAttribute(String key)"}),(0,i.jsx)(t.td,{children:"It fetches the attribute value."})]}),(0,i.jsx)(t.tr,{children:(0,i.jsx)(t.td,{colSpan:"2",children:"Trace Data"})}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void profile(String desc)"}),(0,i.jsx)(t.td,{children:"Recording the trace message"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void profile(String name, String msg)"}),(0,i.jsx)(t.td,{children:"Recording the trace step name and message"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void profile(String name, String msg, int elapsed)"}),(0,i.jsx)(t.td,{children:"It records the transaction trace step name, message, and execution time."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void profile(String name, String msg, int elapsed, int value)"}),(0,i.jsx)(t.td,{children:"Recording the transaction trace step name, message, execution time, and sequence."})]}),(0,i.jsx)(t.tr,{children:(0,i.jsx)(t.td,{colSpan:"2",children:"HTTP Request"})}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String service()"}),(0,i.jsx)(t.td,{children:"It returns the service name."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void service(String name)"}),(0,i.jsx)(t.td,{children:"It sets the service name."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"int serviceHash()"}),(0,i.jsx)(t.td,{children:"It returns the hash value of the service name."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String remoteIp()"}),(0,i.jsx)(t.td,{children:"It returns the service request IP."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void remoteIp(String ip)"}),(0,i.jsx)(t.td,{children:"It sets the service request IP."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"boolean isError()"}),(0,i.jsx)(t.td,{children:"It returns the value whether it is the error or not."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void login(String id)"}),(0,i.jsx)(t.td,{children:"It sets the log-in ID."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String login()"}),(0,i.jsx)(t.td,{children:"It returns the log-in ID."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String httpMethod()"}),(0,i.jsx)(t.td,{children:"It returns the HTTP method."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String httpQuery()"}),(0,i.jsx)(t.td,{children:"It returns the HTTP query."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String httpContentType()"}),(0,i.jsx)(t.td,{children:"It returns the HTTP content type."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String userAgent()"}),(0,i.jsx)(t.td,{children:"It returns the user agent."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"int status()"}),(0,i.jsx)(t.td,{children:"It returns the HTTP status."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"5",style:{textAlign:"center"},children:"$point"}),(0,i.jsx)(t.td,{children:"String class1"}),(0,i.jsx)(t.td,{children:"Class name"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String method"}),(0,i.jsx)(t.td,{children:"Method name"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Object this1"}),(0,i.jsx)(t.td,{children:"Hooking class/method"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Object[] args"}),(0,i.jsx)(t.td,{children:"Arguments"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Object return1"}),(0,i.jsx)(t.td,{children:"Return"})]})]})]})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"parameters-not-provided---common-plug-in-file",children:"Parameters not provided - common plug-in file"}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Parameter"}),(0,i.jsx)(t.th,{children:"Method/variable"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"18",style:{textAlign:"center"},children:"No"}),(0,i.jsx)(t.td,{children:"void log(Object c)"}),(0,i.jsx)(t.td,{children:"Logging through the logger"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void println(Object c)"}),(0,i.jsx)(t.td,{children:"Printing through System.out.printin()"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Object field(Object o, String field)"}),(0,i.jsx)(t.td,{children:"It returns the field value."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Object method(Object o, String method)"}),(0,i.jsx)(t.td,{children:"Invoke method"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Object method(Object o, String method, String param)"}),(0,i.jsx)(t.td,{children:"Invoke method"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String toString(Object o)"}),(0,i.jsx)(t.td,{children:"It returns toSting() as object."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String toString(Object o, String def)"}),(0,i.jsx)(t.td,{children:"It returns toSting() as object and returns def in case of null."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"int syshash(Object o)"}),(0,i.jsx)(t.td,{children:"It returns the hash value."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"int syshash(HookArgs hook, int x)"}),(0,i.jsx)(t.td,{children:"It returns the hash value of the xth argument."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"int syshash(HookArgs hook)"}),(0,i.jsx)(t.td,{children:"It returns the hash value of the argument."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"int cint(Object o)"}),(0,i.jsx)(t.td,{children:"It returns an integer value."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"float cfloat(Object o)"}),(0,i.jsx)(t.td,{children:"It returns a floating value."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String cString(Object o)"}),(0,i.jsx)(t.td,{children:"It returns a string."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"long clong(Object o)"}),(0,i.jsx)(t.td,{children:"It returns a value of long type."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"double cdouble(Object o)"}),(0,i.jsx)(t.td,{children:"It returns a double value."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String desc(Object o)"}),(0,i.jsx)(t.td,{children:"It returns the class signature."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String toJson(Object o)"}),(0,i.jsx)(t.td,{children:"It returns as json."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"void shell(final String cmd, final String env)"}),(0,i.jsx)(t.td,{children:"It executes a shell command."})]})]})]})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"daemon-and-batch",children:"Daemon and batch"}),(0,i.jsx)(t.p,{children:"This API is applied to the methods set as starting points when monitoring the application servers such as daemons and batches. Write code in the following file."}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Application of the service start area: ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/AppServiceStart.x"]})]}),"\n",(0,i.jsxs)(t.li,{children:["Application of the service end area: ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/AppServiceEnd.x"]})]}),"\n"]}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Plug-in file"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Parameter"}),(0,i.jsx)(t.th,{children:"Method/variable"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"2",children:"AppServiceStart.x"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$ctx"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$point"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"AppServiceEnd.x"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$ctx"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]})]})]})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"http-service",children:"HTTP service"}),(0,i.jsxs)(t.p,{children:["This API is applied to the common web applications that use the ",(0,i.jsx)(t.code,{children:"javax.servlet.http.HTTPServlet"})," class. Write code in the following file."]}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Application of the service start area: ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/HttpServiceStart.x"]})]}),"\n",(0,i.jsxs)(t.li,{children:["Application of the service end area: ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/HttpServiceEnd.x"]})]}),"\n"]}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Plug-in file"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Parameter"}),(0,i.jsx)(t.th,{children:"Method/variable"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsxs)(t.td,{rowSpan:"20",children:["HttpServiceStart.x/",(0,i.jsx)("br",{}),"HttpServiceEnd.x"]}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$ctx"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"15",style:{textAlign:"center"},children:"$req"}),(0,i.jsx)(t.td,{children:"String getCookie(String key)"}),(0,i.jsx)(t.td,{children:"It returns the cookie value."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String getRequestURI()"}),(0,i.jsx)(t.td,{children:"It returns RequestURI."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String getRemoteAddr()"}),(0,i.jsx)(t.td,{children:"It returns RemoteAddr."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String getMethod()"}),(0,i.jsx)(t.td,{children:"It returns the HTTP method."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String getQueryString()"}),(0,i.jsx)(t.td,{children:"It returns HTTP QueryString."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String getParameter(String key)"}),(0,i.jsx)(t.td,{children:"It returns the parameter value."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Object getAttribute(String key)"}),(0,i.jsx)(t.td,{children:"It returns the attribute value."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String getHeader(String key)"}),(0,i.jsx)(t.td,{children:"It returns the header value."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Enumeration getParameterNames()"}),(0,i.jsx)(t.td,{children:"It returns getParameterNames."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Enumeration getHeaderNames()"}),(0,i.jsx)(t.td,{children:"It returns getHeaderNames."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"WrSession getSession()"}),(0,i.jsx)(t.td,{children:"It returns the session wrapper."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Set getSessionNames()"}),(0,i.jsx)(t.td,{children:"It returns getSessionNames."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Object getSessionAttribute(String key)"}),(0,i.jsx)(t.td,{children:"It returns getSessionAttribute."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"boolean isOk()"}),(0,i.jsx)(t.td,{children:"It returns the plug-in status."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Throwable error()"}),(0,i.jsx)(t.td,{children:"It returns an error."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"4",style:{textAlign:"center"},children:"$res"}),(0,i.jsx)(t.td,{children:"String getContentType()"}),(0,i.jsx)(t.td,{children:"It returns the content type."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String getCharacterEncoding()"}),(0,i.jsx)(t.td,{children:"It returns the character encoding."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"boolean isOk()"}),(0,i.jsx)(t.td,{children:"It returns the plug-in status."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Throwable error()"}),(0,i.jsx)(t.td,{children:"It returns an error."})]})]})]})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"http-outbound",children:"HTTP Outbound"}),(0,i.jsxs)(t.p,{children:["This API can be applied for HTTP outbound call by using the library such as ",(0,i.jsx)(t.code,{children:"HttpClient"}),". Write code in the following file."]}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Application of the service start area: ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/HttpCallStart.x"]})]}),"\n",(0,i.jsxs)(t.li,{children:["Application of the service end area: ",(0,i.jsxs)(t.em,{children:[(0,i.jsx)(t.code,{children:"$WHATAP_HOME"}),"/plugin/HttpCallEnd.x"]})]}),"\n"]}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Plug-in file"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Parameter"}),(0,i.jsx)(t.th,{children:"Method/variable"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"6",children:"HttpCallStart.x"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$ctx"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"5",style:{textAlign:"center"},children:"$req"}),(0,i.jsx)(t.td,{children:"String url()"}),(0,i.jsx)(t.td,{children:"It returns a URL."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String host()"}),(0,i.jsx)(t.td,{children:"It returns the host name."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"int port()"}),(0,i.jsx)(t.td,{children:"It returns the port."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"boolean isOk()"}),(0,i.jsx)(t.td,{children:"It returns the plug-in status."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Throwable error()"}),(0,i.jsx)(t.td,{children:"It returns an error."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"5",children:"HttpCallEnd.x"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$ctx"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"4",style:{textAlign:"center"},children:"$res"}),(0,i.jsx)(t.td,{children:"String getContentType()"}),(0,i.jsx)(t.td,{children:"It returns the content type."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"String getCharacterEncoding()"}),(0,i.jsx)(t.td,{children:"It returns the character encoding."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"boolean isOk()"}),(0,i.jsx)(t.td,{children:"It returns the plug-in status."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Throwable error()"}),(0,i.jsx)(t.td,{children:"It returns an error."})]})]})]})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"specific-method",children:"Specific method"}),(0,i.jsxs)(t.p,{children:["This API is applied to the method that has been set through the Java agent option (",(0,i.jsx)(t.code,{children:"hook_trace_helper_*"}),")."]}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Plug-in file"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Parameter"}),(0,i.jsx)(t.th,{children:"Method/variable"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"2",children:"TraceHelperStart.x"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$ctx"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$point"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"2",children:"TraceHelperEnd.x"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$ctx"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$point"}),(0,i.jsx)(t.td,{colSpan:"2",children:"See the common attributes."})]})]})]})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"custom-pool",children:"Custom pool"}),(0,i.jsx)(t.p,{children:"This API is used to monitor the custom pool. If the method with the pool usage is set, you can observe it and check statistical information through the WhaTap monitoring service."}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Plug-in file"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Parameter"}),(0,i.jsx)(t.th,{children:"Method/variable"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"4",children:"CustomPool.x"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$id"}),(0,i.jsx)(t.td,{colSpan:"2",children:"ID set in custom_pool_classes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"$pool"}),(0,i.jsx)(t.td,{colSpan:"2",children:"Class set in custom_pool_classes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{rowSpan:"2",style:{textAlign:"center"},children:"$result"}),(0,i.jsx)(t.td,{children:"active(Object o)"}),(0,i.jsx)(t.td,{children:"It sets the active pool count."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"int idle(Object o)"}),(0,i.jsx)(t.td,{children:"It sets the idle pool count."})]})]})]})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h2",children:[(0,i.jsx)(t.h2,{id:"plug-in-application-example",children:"Plug-in application example"}),(0,i.jsx)(t.p,{children:"The following is the actual plug-in application example."})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"search-request-monitoring-of-the-elastic-search-engine",children:"Search request monitoring of the elastic search engine."}),(0,i.jsx)(t.p,{children:"Because the Elasticsearch (ES) engine is not a servlet engine, unstructured monitoring is required. If other products perform metric-based monitoring, you can use WhaTap's plug-in to trace ES requests, process times, and search keywords."}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ini",metastring:"title='whatap.conf'",children:"# Set org.elasticsearch.search.SearchService.executeQueryPhase as the transaction end point.\nhook_service_patterns=org.elasticsearch.search.SearchService.executeQueryPhase\n\n# Each time the method registered in hook_trace_helper_start_patterns is performed, the code in TraceHelperStart.x is executed.\nhook_trace_helper_start_patterns=org.elasticsearch.search.query.QueryPhase.execute\n"})}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:"title='${WHATAP_HOME}/plugin/TraceHelperStart.x' {13,15} showLineNumbers",children:'if ($ctx.inner() == null) {\n    return;\n}\n\ntry {\n    String tclass = "org.elasticsearch.search.query.QueryPhase";\n    String tmethod = "execute";\n\n    if (tclass.equals($point.class1) && tmethod.equals($point.method)) {\n        // The query method call\'s result for the first argument is to be saved in String query.\n        // org.elasticsearch.search.query.QueryPhase.execute(SearchContext searchContext)\n        // It indicates that the result of the invoked SearchContext.query() method is saved in String query.\n        String query = " " + method($point.args[0], "query");\n        // It outputs the string query as the trace information.\n        $ctx.profile(query);\n    }\n} catch(Exception e) {\n    $ctx.profile(e.toString());\n}\n'})})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"excluding-the-collection-of-transactions-flowed-into-a-specific-ip",children:"Excluding the collection of transactions flowed into a specific IP"}),(0,i.jsx)(t.p,{children:"Health Check, a plug-in can be used to exclude transactions caused by internal users."}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:"title='${WHATAP_HOME}/plugin/HttpServiceStart.x' {2} showLineNumbers",children:'// Set the ignoreIP value as the IP to exclude for collection.\nString ignoreIP = "123.234.123.234";\nString remoteIP = $req.getRemoteAddr();\n\nif ($ctx.ok() && remoteIP != null) {\n    if (remoteIP.equals(ignoreIP)) {\n        $ctx.ignore();\n    }\n}\n'})})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"atomikos-pool-monitoring",children:"Atomikos pool monitoring"}),(0,i.jsxs)(t.p,{children:["Apply it by referencing ",(0,i.jsx)(t.a,{href:"https://www.atomikos.com/downloads/transactions-essentials/com/atomikos/AtomikosTransactionsEssentials/javadoc/3.7/com/atomikos/jdbc/AbstractDataSourceBean.html",children:"API document"}),"."]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ini",metastring:"title='whatap.conf'",children:"custom_pool_classes=atomikos@com.atomikos.jdbc.internal.AbstractDataSourceBean\n"})}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:"title='${WHATAP_HOME}/plugin/CustomPool.x'",children:'int total = cint(method($pool,"poolTotalSize"));\nint avail = cint(method($pool,"poolAvailableSize"));\n\n$result.active(total - avail);\n$result.idle(avail);\n'})})]}),"\n",(0,i.jsxs)(t.section,{className:"remark-sectionize-h3",children:[(0,i.jsx)(t.h3,{id:"presenting-the-cookie-value-in-the-transaction-trace",children:"Presenting the cookie value in the transaction trace"}),(0,i.jsx)(t.p,{children:"You can see the cookie value in the transaction trace."}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",metastring:"title='${WHATAP_HOME}/plugin/HttpServiceStart.x' {2} showLineNumbers",children:'// Set the cookie to check with the $req.getCookie() parrameter.\nString cookie = $req.getCookie("AWSALB");\n\nif ($ctx.ok()) {\n    if (cookie != null) {\n        $ctx.profile(cookie);\n    }\n}\n'})})]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},71969:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/java-script-plugin-1-f799ac50d84e46a2190cb994e2d6fcf9.png"},41386:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/java-script-plugin-2-f799ac50d84e46a2190cb994e2d6fcf9.png"},28453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>l});var i=n(96540);const r={},s=i.createContext(r);function c(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);